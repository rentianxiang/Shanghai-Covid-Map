<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>上海疫情地图 2022-04-07</title>
</head>
<script charset="utf-8" src="https://map.qq.com/api/gljs?v=1.exp&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77"></script>
<style type="text/css">
    html,
    body {
        height: 100%;
        margin: 0px;
        padding: 0px;
    }

    #container {
        width: 100%;
        height: 100%;
    }
</style>

<body onload="initMap()">
    <div id="qqmap"></div>
</body>

<script type="text/javascript">
    async function initMap() {
        const map = new TMap.Map("qqmap", {
            rotation: 0,
            pitch: 15,
            zoom: 12,
            center: new TMap.LatLng(31.2, 121.4)
        });
        const data = await getData();
        const marker = new TMap.MultiMarker({
            id: "marker",
            map,
            geometries: data.map(({ s: street, lat, lng }, index) => ({
                id: index,
                position: new TMap.LatLng(lat, lng),
                properties: { title: street }
            }))
        });
        const infoWindow = new TMap.InfoWindow({
            map: map,
            position: new TMap.LatLng(39.984104, 116.307503),
            offset: { x: 0, y: -32 }
        });
        infoWindow.close()
        marker.on("click", function (event) {
            infoWindow.open();
            infoWindow.setPosition(event.geometry.position);
            infoWindow.setContent(event.geometry.properties.title);
        })
    }
    async function getData() {
        const response = await fetch('../data/2022-04-07.json')
        const data = await response.json()
        return data
    }
</script>

</html>